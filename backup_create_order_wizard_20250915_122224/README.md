# Бекап мастера создания заказа с загрузкой чертежей и QR-кодом

**Дата создания**: 15 сентября 2025, 12:22:24

## Описание

Полный бекап мастера создания заказа с интегрированной функциональностью:
- ✅ Загрузка чертежей и документов
- ✅ Генерация QR-кода
- ✅ Пошаговый интерфейс
- ✅ Валидация данных
- ✅ Drag & Drop загрузка файлов

## Содержимое бекапа

### Основные файлы
- `CreateOrderWizard.js` - основной компонент мастера
- `DrawingUpload.js` - компонент загрузки чертежей
- `QRCodeGenerator.js` - компонент генерации QR-кода
- `api.js` - API сервисы
- `orders.js` - серверные маршруты

### Тестовые файлы
- `test_drawing_upload.html` - тест загрузки чертежей
- `CreateOrderWizard_Standalone.html` - автономная версия мастера

## Функциональность

### 1. Мастер создания заказа
- **5 шагов**: Клиент → Заказ → Доставка → Финансы → Обзор
- **Валидация**: на каждом шаге с отображением ошибок
- **Навигация**: вперед/назад с сохранением прогресса
- **Прогресс-бар**: визуальное отображение этапов

### 2. Загрузка чертежей
- **Поддерживаемые форматы**: PDF, DWG, DXF, JPG, JPEG, PNG, TIFF, BMP
- **Ограничения**: максимум 10 файлов по 10MB каждый
- **Интерфейс**: Drag & Drop + выбор файлов
- **Управление**: просмотр, скачивание, удаление файлов

### 3. Генерация QR-кода
- **Автоматическая**: после создания заказа
- **API**: `/api/production/generate-qr/:orderId`
- **Отображение**: в отдельном блоке после создания

## Технические детали

### Компоненты React
```javascript
// Основные компоненты
- CreateOrderWizard (главный компонент)
- DrawingUpload (загрузка файлов)
- QRCodeGenerator (генерация QR-кода)
```

### API эндпоинты
```javascript
// Заказы
POST /api/orders - создание заказа
GET /api/orders/:id - получение заказа

// Чертежи
POST /api/orders/:id/drawings - загрузка чертежа
GET /api/orders/:id/drawings - список чертежей
GET /api/orders/:id/drawings/:drawingId - скачивание
DELETE /api/orders/:id/drawings/:drawingId - удаление

// QR-код
POST /api/production/generate-qr/:orderId - генерация QR
```

### Состояние компонентов
```javascript
// Основные состояния
- currentStep (текущий шаг)
- completedSteps (завершенные шаги)
- clientInfo (информация о клиенте)
- orderDetails (детали заказа)
- deliveryInfo (доставка)
- financialInfo (финансы)
- drawings (чертежи)
- errors (ошибки валидации)
```

## Использование

### 1. Автономная версия
Откройте `CreateOrderWizard_Standalone.html` в браузере:
- Не требует сервера
- Полная функциональность интерфейса
- Тестирование UI/UX

### 2. Интеграция в проект
Скопируйте файлы в соответствующие директории:
```bash
# Компоненты
client/src/pages/Orders/CreateOrderWizard.js
client/src/components/UI/DrawingUpload.js
client/src/components/Production/QRCodeGenerator.js

# API
client/src/services/api.js
server/routes/orders.js
```

### 3. Тестирование
Запустите `test_drawing_upload.html` для тестирования:
- Загрузка файлов
- Валидация форматов
- API интеграция

## Валидация

### Клиентская валидация
- **Шаг 1**: ФИО и телефон обязательны, email формат
- **Шаг 2**: Название продукта, минимум одна позиция
- **Шаг 3**: Адрес доставки обязателен
- **Шаг 4**: Сумма предоплаты не отрицательная

### Валидация файлов
- **Формат**: проверка расширения и MIME типа
- **Размер**: максимум 10MB на файл
- **Количество**: максимум 10 файлов

## Безопасность

- **Аутентификация**: все API запросы требуют токен
- **Валидация**: проверка на клиенте и сервере
- **Файлы**: сохранение в базе данных (BLOB)
- **CORS**: настройка для загрузки файлов

## Производительность

- **Ленивая загрузка**: компоненты загружаются по требованию
- **Оптимизация**: минимизация перерендеров
- **Кэширование**: локальное хранение состояния
- **Сжатие**: файлы сжимаются перед отправкой

## Совместимость

- **Браузеры**: Chrome 90+, Firefox 88+, Safari 14+
- **React**: 18.0+
- **Node.js**: 16.0+
- **База данных**: PostgreSQL 12+

## Восстановление

### 1. Полное восстановление
```bash
# Скопировать все файлы
cp -r backup_create_order_wizard_20250915_122224/* ./

# Установить зависимости
npm install

# Запустить проект
npm run dev
```

### 2. Частичное восстановление
```bash
# Только компоненты
cp backup_create_order_wizard_20250915_122224/CreateOrderWizard.js client/src/pages/Orders/
cp backup_create_order_wizard_20250915_122224/DrawingUpload.js client/src/components/UI/

# Только API
cp backup_create_order_wizard_20250915_122224/api.js client/src/services/
cp backup_create_order_wizard_20250915_122224/orders.js server/routes/
```

## Известные ограничения

1. **Размер файлов**: максимум 10MB на файл
2. **Количество файлов**: максимум 10 на заказ
3. **Форматы**: только указанные типы файлов
4. **Браузеры**: требуется поддержка File API

## Будущие улучшения

- [ ] Предварительный просмотр изображений
- [ ] Сжатие файлов перед загрузкой
- [ ] Прогресс-бар загрузки
- [ ] Пакетная загрузка
- [ ] Облачное хранение
- [ ] Версионирование чертежей

## Контакты

При возникновении проблем с восстановлением или использованием бекапа, обратитесь к разработчику.

---
**Версия**: 1.0.0  
**Дата**: 15.09.2025  
**Статус**: Готов к продакшену ✅

















