<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sofany Pro CRM</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
    :root {
        --primary: #0ea5a5;
        --primary-dark: #0b8f8f;
        --primary-light: #e0f7f7;
        --success: #10b981;
        --success-light: #d1fae5;
        --warning: #f59e0b;
        --error: #ef4444;
        --purple: #8b5cf6;
        --pink: #ec4899;
        --blue: #3b82f6;
        --text: #0f172a;
        --text-muted: #64748b;
        --bg: #f8fafc;
        --card-bg: #ffffff;
        --border: #e2e8f0;
        --border-light: #f1f5f9;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Inter', sans-serif;
    }

    body {
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
    }

    .app-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
    }

    /* Header */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--border);
    }

    .logo {
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .user-info {
        color: var(--text-muted);
        font-weight: 500;
    }

    /* Status Bar - на всю ширину */
    .status-bar {
        background: var(--card-bg);
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        max-width: 100%;
        width: 100%;
        box-sizing: border-box;
        margin-bottom: 2rem;
        border: 1px solid var(--border-light);
    }

    .status-bar-label {
        display: inline-block;
        font-size: 0.98rem;
        font-weight: 600;
        color: var(--primary);
        background: var(--primary-light);
        border-radius: 0.7em;
        padding: 0.25em 1.1em 0.25em 1.1em;
        margin-bottom: 0.7em;
        letter-spacing: 0.03em;
        box-shadow: 0 1px 6px #0ea5a51a;
    }

    .status-buttons {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 0.75rem;
    }

    .status-btn {
        padding: 1rem;
        border: 2px solid var(--border);
        border-radius: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
        font-size: 0.9rem;
        background: var(--bg);
        color: var(--text);
    }

    .status-btn.active {
        border-color: var(--primary);
        background: var(--primary);
        color: white;
        box-shadow: 0 0 0 3px rgba(14, 165, 165, 0.2);
    }

    /* Main Grid */
    .main-grid {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 2rem;
    }

    /* Cards */
    .card {
        background: var(--card-bg);
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
        border: 1px solid var(--border-light);
    }

    .card-header {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border);
    }

    .card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .card-icon {
        color: var(--primary);
        font-size: 1.5rem;
        /* Убираем emoji, используем SVG */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Material Calculator */
    .material-form {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr auto;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }

    .form-input {
        width: 100%;
        padding: 0.875rem;
        border: 1px solid var(--border);
        border-radius: 0.75rem;
        font-size: 1rem;
        transition: all 0.2s;
        background: var(--bg);
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
    }

    /* Красивая бирюзовая кнопка добавления */
    .btn-add {
        padding: 0.875rem 1rem;
        border: none;
        border-radius: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        background: linear-gradient(135deg, var(--success) 0%, var(--purple) 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        box-shadow: var(--shadow);
    }

    .btn-add:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-hover);
        filter: brightness(1.08);
    }

    /* Красная круглая кнопка-крестик для удаления материала */
    .btn-remove {
        width: 2.2rem;
        height: 2.2rem;
        border-radius: 50%;
        border: none;
        background: linear-gradient(135deg, var(--error) 0%, #ff7b7b 100%);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        cursor: pointer;
        transition: box-shadow 0.2s, transform 0.2s, background 0.2s;
        box-shadow: 0 2px 8px #ef444422;
    }
    .btn-remove:hover {
        background: linear-gradient(135deg, #ff1a1a 0%, #ff7b7b 100%);
        transform: scale(1.08);
        box-shadow: 0 4px 16px #ef444455;
    }

    .material-list {
        border: 1px solid var(--border);
        border-radius: 0.75rem;
        overflow: hidden;
        margin-bottom: 1.5rem;
    }

    .material-item {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr auto;
        gap: 0.75rem;
        padding: 1rem;
        border-bottom: 1px solid var(--border);
        align-items: center;
        background: var(--bg);
    }

    .material-item:last-child {
        border-bottom: none;
    }

    /* Calculator Actions - облегченные кнопки */
    .calculator-actions {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .calc-action-btn {
        padding: 0.875rem;
        border: 2px solid var(--border);
        border-radius: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
        background: var(--bg);
        color: var(--text);
        font-size: 0.9rem;
    }

    .calc-action-btn:hover {
        border-color: var(--primary);
        background: var(--primary-light);
    }

    /* Client Info - расширенные поля */
    .client-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-label {
        display: block;
        font-weight: 500;
        margin-bottom: 0.5rem;
        color: var(--text);
    }

    textarea.form-input {
        resize: vertical;
        min-height: 100px;
    }

    /* Dashboard */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .metric-card {
        background: linear-gradient(135deg, var(--card-bg) 0%, var(--primary-light) 100%);
        padding: 1.5rem;
        border-radius: 1rem;
        border: 1px solid var(--border);
        text-align: center;
        box-shadow: var(--shadow);
        min-height: 120px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .metric-value {
        font-size: 1.4rem; /* Уменьшено на 40% */
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: var(--primary-dark);
    }

    .metric-label {
        color: var(--text-muted);
        font-size: 0.875rem;
        font-weight: 500;
    }

    /* Margin Slider */
    .slider-container {
        margin: 1.5rem 0;
    }

    .slider-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .slider-label {
        font-weight: 600;
        color: var(--text);
    }

    .slider-value {
        font-weight: 700;
        color: var(--primary);
        background: var(--primary-light);
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.875rem;
    }

    .slider {
        width: 100%;
        height: 6px;
        -webkit-appearance: none;
        background: var(--border);
        border-radius: 3px;
        outline: none;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--primary);
        cursor: pointer;
        border: 3px solid white;
        box-shadow: var(--shadow);
    }

    /* Cost Breakdown */
    .cost-breakdown {
        margin-bottom: 2rem;
    }

    .cost-item {
        display: flex;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border);
    }

    .cost-item:last-child {
        border-bottom: none;
        font-weight: 700;
        color: var(--primary-dark);
        padding-top: 1rem;
    }

    /* Блок оплаты */
    .payment-block {
        background: var(--card-bg);
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
        border: 1px solid var(--border-light);
    }

    .payment-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .payment-option {
        padding: 1rem;
        border: 2px solid var(--border);
        border-radius: 0.75rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        background: var(--bg);
    }

    .payment-option.active {
        border-color: var(--primary);
        background: var(--primary-light);
    }

    .payment-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: 1rem;
    }

    /* Документы - в стиле карточек */
    .documents-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin: 1.5rem 0;
    }

    .doc-card {
        background: linear-gradient(135deg, var(--card-bg) 0%, var(--primary-light) 100%);
        padding: 1.25rem;
        border-radius: 1rem;
        border: 1px solid var(--border);
        text-align: center;
        box-shadow: var(--shadow);
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100px;
    }

    .doc-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
    }

    .doc-icon {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: var(--primary);
    }

    .doc-title {
        font-weight: 600;
        color: var(--text);
        font-size: 0.9rem;
    }

    /* Добавляем стили для узких карточек документов */
    .documents-grid-narrow {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.5rem;
        margin: 0.5rem 0 0.5rem 0;
    }
    .doc-card-narrow {
        padding: 0.5rem 0.25rem;
        min-height: 60px;
        border-radius: 0.5rem;
        font-size: 0.85rem;
    }
    .doc-card-narrow .doc-icon {
        font-size: 1.1rem;
        margin-bottom: 0.25rem;
    }
    .doc-title {
        font-size: 0.8rem;
        padding: 0 2px;
    }
    @media (max-width: 700px) {
        .documents-grid-narrow {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* iOS-style switch */
    .ios-switch {
      position: relative;
      display: inline-block;
      width: 48px;
      height: 28px;
      vertical-align: middle;
    }
    .ios-switch input { display: none; }
    .ios-slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--border);
      border-radius: 28px;
      transition: background 0.2s;
    }
    .ios-slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 2px 6px #0001;
      transition: transform 0.2s;
    }
    .ios-switch input:checked + .ios-slider {
      background: var(--primary);
    }
    .ios-switch input:checked + .ios-slider:before {
      transform: translateX(20px);
    }
    .ios-switch-label {
      margin-left: 12px;
      font-weight: 500;
      color: var(--text);
      vertical-align: middle;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .main-grid {
            grid-template-columns: 1fr;
        }
        
        .status-buttons {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .material-form {
            grid-template-columns: 1fr 1fr;
        }
        
        .client-form {
            grid-template-columns: 1fr;
        }
        
        .calculator-actions {
            grid-template-columns: 1fr;
        }
        
        .documents-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .payment-options,
        .payment-form {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .app-container {
            padding: 1rem;
        }
        
        .header {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }
        
        .status-buttons {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .metrics-grid {
            grid-template-columns: 1fr;
        }
        
        .documents-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 480px) {
        .status-buttons {
            grid-template-columns: 1fr;
        }
        
        .material-form {
            grid-template-columns: 1fr;
        }
    }

    @media (min-width: 1024px) {
        .main-grid {
            grid-template-columns: 1fr 400px;
        }
        .status-bar {
            max-width: none;
            width: auto;
        }
        .left-column > .status-bar {
            max-width: 100%;
            width: 100%;
        }
        .left-column > .card {
            max-width: 100%;
        }
    }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="logo">Sofany Pro CRM</div>
            <div class="user-info">
                <span>Менеджер: </span>
                <span style="color: var(--primary); font-weight: 600;">Анна Петрова</span>
            </div>
        </header>

        <div class="main-grid">
            <!-- Левая колонка - Основная работа -->
            <div class="left-column">
                <!-- Статус заказа -->
                <div class="status-bar">
                    <div class="status-bar-label">Статус заказа</div>
                    <div class="status-buttons">
                        <button class="status-btn">Закупка</button>
                        <button class="status-btn">КБ</button>
                        <button class="status-btn active">Столярный цех</button>
                        <button class="status-btn">Швейный цех</button>
                        <button class="status-btn">Обивочный цех</button>
                        <button class="status-btn">Склад ГП</button>
                    </div>
                </div>

                <!-- Калькулятор материалов -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon"> <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg> </span>
                        <h2 class="card-title">Калькулятор материалов</h2>
                    </div>
                    
                    <div class="material-form">
                        <input type="text" class="form-input" placeholder="Наименование материала">
                        <input type="number" class="form-input" placeholder="Кол-во">
                        <input type="number" class="form-input" placeholder="Цена за ед.">
                        <button class="btn-add">+ Добавить</button>
                    </div>

                    <div class="material-list">
                        <div class="material-item">
                            <span>Ткань мебельная "Премиум"</span>
                            <span>5 м</span>
                            <span>12 500 ₽</span>
                            <button class="btn-remove" title="Удалить">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="5" x2="15" y2="15"/><line x1="15" y1="5" x2="5" y2="15"/></svg>
                            </button>
                        </div>
                        <div class="material-item">
                            <span>Поролон HR 35</span>
                            <span>2 шт</span>
                            <span>3 800 ₽</span>
                            <button class="btn-remove" title="Удалить">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="5" x2="15" y2="15"/><line x1="15" y1="5" x2="5" y2="15"/></svg>
                            </button>
                        </div>
                        <div class="material-item">
                            <span>Деревянный брус</span>
                            <span>3 м</span>
                            <span>2 400 ₽</span>
                            <button class="btn-remove" title="Удалить">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="5" x2="15" y2="15"/><line x1="15" y1="5" x2="5" y2="15"/></svg>
                            </button>
                        </div>
                    </div>

                    <!-- Облегченные кнопки калькулятора -->
                    <div class="calculator-actions">
                        <button class="calc-action-btn">В закупку</button>
                        <button class="calc-action-btn">В производство</button>
                        <button class="calc-action-btn">Удалить заказ</button>
                    </div>
                </div>

                <!-- Информация о клиенте -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon"> <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M6 20v-2a4 4 0 0 1 4-4h0a4 4 0 0 1 4 4v2"/></svg> </span>
                        <h2 class="card-title">Информация о клиенте</h2>
                    </div>
                    
                    <div class="client-form">
                        <div class="form-group">
                            <label class="form-label">Имя</label>
                            <input type="text" class="form-input" value="Иван">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Фамилия</label>
                            <input type="text" class="form-input" value="Петров">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Телефон</label>
                            <input type="tel" class="form-input" value="+7 (900) 123-45-67">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" value="ivan@example.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Дата оплаты</label>
                            <input type="date" class="form-input" value="2023-06-15">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Дедлайн</label>
                            <input type="date" class="form-input" value="2023-07-10">
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label class="form-label">Адрес доставки</label>
                            <input type="text" class="form-input" value="г. Москва, ул. Примерная, д. 123">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Комментарий к заказу</label>
                        <textarea class="form-input">Угловой диван с тремя подушками, цвет голубой. Механизм трансформации "еврокнижка".</textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Чертеж/эскиз</label>
                        <input type="file" class="form-input">
                    </div>
                </div>

                <!-- Документы - в стиле карточек, теперь в левой колонке -->
                <div class="card documents-card" style="width:100%; max-width:none; margin: 0 0 2rem 0;">
                    <div class="card-header">
                        <span class="card-icon"> <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="7" width="18" height="13" rx="2"/><path d="M16 3v4"/><path d="M8 3v4"/></svg> </span>
                        <h2 class="card-title">Документы</h2>
                    </div>
                    <div class="documents-grid documents-grid-narrow">
                        <div class="doc-card doc-card-narrow">
                            <div class="doc-icon"> <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg> </div>
                            <div class="doc-title">Экспорт</div>
                        </div>
                        <div class="doc-card doc-card-narrow">
                            <div class="doc-icon"> <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg> </div>
                            <div class="doc-title">Заказ-наряд</div>
                        </div>
                        <div class="doc-card doc-card-narrow">
                            <div class="doc-icon"> <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg> </div>
                            <div class="doc-title">КП</div>
                        </div>
                        <div class="doc-card doc-card-narrow">
                            <div class="doc-icon"> <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg> </div>
                            <div class="doc-title">Договор</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Правая колонка - Дашборд -->
            <div class="right-column">
                <!-- Заказы из калькулятора -->
                <div class="card" id="calc-orders-card">
                    <div class="card-header" style="justify-content: space-between;">
                        <div class="card-title" style="display:flex;align-items:center;gap:0.5rem;">
                            <span class="card-icon"> <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg> </span>
                            Заказы из калькулятора
                        </div>
                        <div style="display:flex;gap:0.5rem;align-items:center;">
                            <input type="text" id="jwt-input" class="form-input" placeholder="JWT токен" style="max-width: 260px;" />
                            <button class="calc-action-btn" id="save-jwt-btn">Сохранить</button>
                            <button class="calc-action-btn" id="refresh-orders-btn">Обновить</button>
                        </div>
                    </div>
                    <div id="calc-orders-status" style="color: var(--text-muted); font-size: 0.9rem; margin-bottom:0.75rem;">Вставьте JWT и нажмите Обновить</div>
                    <div style="overflow:auto; border:1px solid var(--border); border-radius:0.75rem;">
                        <table style="width:100%; border-collapse:collapse; min-width:640px;">
                            <thead style="background:var(--bg);">
                                <tr>
                                    <th style="text-align:left; padding:0.75rem; border-bottom:1px solid var(--border);">ID</th>
                                    <th style="text-align:left; padding:0.75rem; border-bottom:1px solid var(--border);">Клиент</th>
                                    <th style="text-align:left; padding:0.75rem; border-bottom:1px solid var(--border);">Цена</th>
                                    <th style="text-align:left; padding:0.75rem; border-bottom:1px solid var(--border);">Дата</th>
                                    <th style="text-align:left; padding:0.75rem; border-bottom:1px solid var(--border);">Действия</th>
                                </tr>
                            </thead>
                            <tbody id="calc-orders-tbody">
                                <tr><td colspan="5" style="padding:0.9rem; color:var(--text-muted);">Нет данных</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Финансовые метрики -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon"> <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg> </span>
                        <h2 class="card-title">Финансовые метрики</h2>
                    </div>
                    
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value">45 300 ₽</div>
                            <div class="metric-label">Себестоимость</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">69 800 ₽</div>
                            <div class="metric-label">Цена продажи</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">24 500 ₽</div>
                            <div class="metric-label">Прибыль</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">35%</div>
                            <div class="metric-label">Маржинальность</div>
                        </div>
                    </div>

                    <!-- Ползунок наценки -->
                    <div class="slider-container">
                        <div class="slider-header">
                            <span class="slider-label">Уровень наценки</span>
                            <span class="slider-value" id="margin-value">35%</span>
                        </div>
                        <input type="range" class="slider" id="margin-slider" min="0" max="100" value="35" step="5">
                    </div>
                </div>

                <!-- Блок оплаты -->
                <div class="payment-block">
                    <div class="card-header">
                        <span class="card-icon"> <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3v4"/><path d="M8 3v4"/></svg> </span>
                        <h2 class="card-title">Оплата</h2>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Сумма сделки</label>
                        <input type="number" class="form-input" id="deal-amount" placeholder="0 ₽" value="69800">
                    </div>
                    <div class="payment-options" style="margin-bottom: 1.5rem;">
                        <div class="payment-option payment-cash active" data-type="cash">
                            <span style="font-weight: 600;">Наличные</span>
                        </div>
                        <div class="payment-option payment-transfer" data-type="transfer">
                            <span style="font-weight: 600;">Перевод</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Дата оплаты</label>
                        <input type="date" class="form-input" value="2023-06-15">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Сумма предоплаты</label>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <input type="range" class="slider" id="prepay-slider" min="0" max="100" value="50" step="1" style="flex:2;">
                            <span class="slider-value" id="prepay-percent">50%</span>
                            <span class="slider-value" id="prepay-amount">34 900 ₽</span>
                        </div>
                    </div>
                    <div class="form-group" style="display:flex;align-items:center;gap:1rem;">
                        <label class="form-label" style="margin-bottom:0;">Оплачен полностью</label>
                        <label class="ios-switch">
                          <input type="checkbox" id="paid-switch">
                          <span class="ios-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Детализация затрат -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon"> <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M12 8v8"/><path d="M8 12h8"/><circle cx="12" cy="12" r="10"/></svg> </span>
                        <h2 class="card-title">Детализация затрат</h2>
                    </div>
                    
                    <div class="cost-breakdown">
                        <div class="cost-item">
                            <span>Пиломатериалы:</span>
                            <span>15 200 ₽</span>
                        </div>
                        <div class="cost-item">
                            <span>Наполнители:</span>
                            <span>8 700 ₽</span>
                        </div>
                        <div class="cost-item">
                            <span>Комплектующие:</span>
                            <span>12 800 ₽</span>
                        </div>
                        <div class="cost-item">
                            <span>Работа:</span>
                            <span>7 400 ₽</span>
                        </div>
                        <div class="cost-item">
                            <span>Доставка:</span>
                            <span>1 200 ₽</span>
                        </div>
                        <div class="cost-item">
                            <span style="font-weight: 700;">Итого:</span>
                            <span style="font-weight: 700; color: var(--primary-dark);">45 300 ₽</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Скрипт для управления статусами
    const statusButtons = document.querySelectorAll('.status-btn');
    statusButtons.forEach(button => {
        button.addEventListener('click', () => {
            // Удаляем класс active у всех кнопок
            statusButtons.forEach(btn => btn.classList.remove('active'));
            // Добавляем класс active к нажатой кнопке
            button.classList.add('active');
        });
    });

    // Скрипт для калькулятора материалов
    const btnAdd = document.querySelector('.btn-add');
    if (btnAdd) {
        btnAdd.addEventListener('click', () => {
            const materialName = document.querySelector('input[placeholder="Наименование материала"]').value;
            const quantity = document.querySelector('input[placeholder="Кол-во"]').value;
            const price = document.querySelector('input[placeholder="Цена за ед."]').value;

            if (materialName && quantity && price) {
                // Здесь должна быть логика добавления материала в список
                console.log(`Добавить материал: ${materialName}, Кол-во: ${quantity}, Цена: ${price}`);
            } else {
                alert('Пожалуйста, заполните все поля.');
            }
        });
    }

    // Переключение способов оплаты (наличные/перевод)
    const paymentOptions = document.querySelectorAll('.payment-option');
    paymentOptions.forEach(option => {
        option.addEventListener('click', () => {
            paymentOptions.forEach(opt => opt.classList.remove('active'));
            option.classList.add('active');
        });
    });

    // Сумма сделки и предоплата
    const dealAmountInput = document.getElementById('deal-amount');
    const prepaySlider = document.getElementById('prepay-slider');
    const prepayPercent = document.getElementById('prepay-percent');
    const prepayAmount = document.getElementById('prepay-amount');

    function updatePrepay() {
        const deal = parseFloat(dealAmountInput.value) || 0;
        const percent = parseInt(prepaySlider.value, 10) || 0;
        prepayPercent.textContent = percent + '%';
        prepayAmount.textContent = deal ? (Math.round(deal * percent / 100)).toLocaleString() + ' ₽' : '0 ₽';
    }
    dealAmountInput.addEventListener('input', updatePrepay);
    prepaySlider.addEventListener('input', updatePrepay);
    updatePrepay();

    // iOS switch: если включён, предоплата = 100%
    const paidSwitch = document.getElementById('paid-switch');
    paidSwitch.addEventListener('change', function() {
        if (this.checked) {
            prepaySlider.value = 100;
            prepaySlider.disabled = true;
        } else {
            prepaySlider.disabled = false;
        }
        updatePrepay();
    });

    // Удаляем скрипт выравнивания ширины блока статус заказа
    
    // =========================
    // Интеграция заказов калькулятора
    // =========================
    const API_BASE = 'http://localhost:5000/api';
    const calcStatusEl = document.getElementById('calc-orders-status');
    const tbody = document.getElementById('calc-orders-tbody');
    const jwtInput = document.getElementById('jwt-input');
    const saveJwtBtn = document.getElementById('save-jwt-btn');
    const refreshBtn = document.getElementById('refresh-orders-btn');

    // Инициализация токена из localStorage
    const savedJwt = localStorage.getItem('sofany_jwt');
    if (savedJwt && jwtInput) jwtInput.value = savedJwt;

    if (saveJwtBtn) {
      saveJwtBtn.addEventListener('click', () => {
        const token = (jwtInput?.value || '').trim();
        if (!token) {
          calcStatusEl.textContent = 'Введите JWT токен.';
          return;
        }
        localStorage.setItem('sofany_jwt', token);
        calcStatusEl.textContent = 'JWT сохранён.';
      });
    }

    if (refreshBtn) {
      refreshBtn.addEventListener('click', loadCalcOrders);
    }

    async function loadCalcOrders() {
      try {
        calcStatusEl.textContent = 'Загрузка...';
        const jwt = (jwtInput?.value || localStorage.getItem('sofany_jwt') || '').trim();
        if (!jwt) {
          calcStatusEl.textContent = 'Требуется JWT.';
          return;
        }
        const res = await fetch(`${API_BASE}/calculator/orders`, {
          headers: { Authorization: `Bearer ${jwt}` }
        });
        if (!res.ok) {
          const text = await res.text();
          throw new Error(`${res.status} ${res.statusText} - ${text}`);
        }
        const data = await res.json();
        renderOrders(Array.isArray(data?.orders) ? data.orders : data);
        calcStatusEl.textContent = 'Готово';
      } catch (e) {
        calcStatusEl.textContent = `Ошибка: ${e.message}`;
        tbody.innerHTML = '<tr><td colspan="5" style="padding:0.9rem; color:var(--error);">Не удалось загрузить</td></tr>';
      }
    }

    function renderOrders(orders) {
      if (!orders || orders.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="padding:0.9rem; color:var(--text-muted);">Нет данных</td></tr>';
        return;
      }
      tbody.innerHTML = orders.map(o => {
        const id = o.id ?? o.order_id ?? '';
        const customerName = o.customer?.name || o.calculator_data?.customer?.name || '—';
        const price = o.pricing?.price || o.calculator_data?.pricing?.price || o.price || 0;
        const createdAt = o.created_at || o.createdAt || '';
        const priceFmt = Number(price) ? Number(price).toLocaleString('ru-RU') + ' ₽' : '—';
        const dateFmt = createdAt ? new Date(createdAt).toLocaleString('ru-RU') : '—';
        return `
          <tr>
            <td style="padding:0.7rem; border-bottom:1px solid var(--border);">${id}</td>
            <td style="padding:0.7rem; border-bottom:1px solid var(--border);">${customerName}</td>
            <td style="padding:0.7rem; border-bottom:1px solid var(--border);">${priceFmt}</td>
            <td style="padding:0.7rem; border-bottom:1px solid var(--border);">${dateFmt}</td>
            <td style="padding:0.7rem; border-bottom:1px solid var(--border);">
              <button class="calc-action-btn" data-id="${id}" onclick="window.open('http://localhost:3000/calculator/orders/${id}', '_blank')">Открыть</button>
            </td>
          </tr>`;
      }).join('');
    }

    // Автозагрузка при наличии токена
    if (savedJwt) {
      loadCalcOrders();
    }
    </script>
</body>
</html>

