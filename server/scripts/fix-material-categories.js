const db = require('../config/database');

// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
const correctMappings = {
  // –ü–ü–£ –º–∞—Ç–µ—Ä–∏–∞–ª—ã -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ü–ü–£" (ID: 1)
  '–ü–ü–£ 25 –∫–≥/–º¬≥ 30x20 —Å–º': 1,
  '–ü–ü–£ 35 –∫–≥/–º¬≥ 30x20 —Å–º': 1,
  '–ü–ü–£ 40 –∫–≥/–º¬≥ 30x20 —Å–º': 1,
  '–ü–ü–£ 45 –∫–≥/–º¬≥ 30x20 —Å–º': 1,
  '–ü–ü–£ 50 –∫–≥/–º¬≥ 30x20 —Å–º': 1,
  '–ü–ü–£ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å 25': 1,

  // –¢–∫–∞–Ω–∏ -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–¢–∫–∞–Ω–∏" (ID: 2)
  '–í–µ–ª—é—Ä "–ö–∞—Ä–∞–º–µ–ª—å"': 2,
  '–í–µ–ª—é—Ä "–®–æ–∫–æ–ª–∞–¥"': 2,
  '–ñ–∞–∫–∫–∞—Ä–¥ "–¶–≤–µ—Ç–æ—á–Ω—ã–π"': 2,
  '–ú–∏–∫—Ä–æ—Ñ–∏–±—Ä–∞ "–°–µ—Ä—ã–π"': 2,
  '–§–ª–æ–∫ "–ë–µ–∂–µ–≤—ã–π"': 2,
  '–®–µ–Ω–∏–ª–ª "–°–∏–Ω–∏–π"': 2,
  '–†–æ–≥–æ–∂–∫–∞ "–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π"': 2,
  '–¢–∫–∞–Ω—å –≤–µ–ª—é—Ä —Å–µ—Ä–∞—è': 2,
  '–¢–∫–∞–Ω—å –∫–æ–∂–∑–∞–º —á–µ—Ä–Ω–∞—è': 2,

  // –ö–æ–∂–∞ -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ö–æ–∂–∞" (ID: 3)
  '–≠–∫–æ–∫–æ–∂–∞ "–ß–µ—Ä–Ω–∞—è"': 3,
  '–≠–∫–æ–∫–æ–∂–∞ "–ö–æ—Ä–∏—á–Ω–µ–≤–∞—è"': 3,
  '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –∫–æ–∂–∞ "–ß–µ—Ä–Ω–∞—è"': 3,
  '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –∫–æ–∂–∞ "–ö–æ—Ä–∏—á–Ω–µ–≤–∞—è"': 3,

  // –§–∞–Ω–µ—Ä–∞ -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–§–∞–Ω–µ—Ä–∞" (ID: 4)
  '–§–∞–Ω–µ—Ä–∞ 6 –º–º': 4,
  '–§–∞–Ω–µ—Ä–∞ 9 –º–º': 4,
  '–§–∞–Ω–µ—Ä–∞ 12 –º–º': 4,
  '–§–∞–Ω–µ—Ä–∞ 15 –º–º': 4,
  '–§–∞–Ω–µ—Ä–∞ 18 –º–º': 4,
  '–§–∞–Ω–µ—Ä–∞ 12–º–º —Ö–≤–æ–π–Ω–∞—è': 4,
  '–§–∞–Ω–µ—Ä–∞ 18–º–º –±–µ—Ä–µ–∑–∞': 4,

  // –î–í–ü -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–î–í–ü" (ID: 5)
  '–î–í–ü 3.2 –º–º': 5,
  '–î–í–ü 4.8 –º–º': 5,
  '–î–í–ü 6.4 –º–º': 5,
  '–î–í–ü 3.2–º–º': 5,

  // –§—É—Ä–Ω–∏—Ç—É—Ä–∞ -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ö—Ä–µ–ø–µ–∂" (ID: 8)
  '–ü–µ—Ç–ª–∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ': 8,
  '–†—É—á–∫–∏ —Ö—Ä–æ–º 128–º–º': 8,

  // –ö–ª–µ–π –∏ –≥–µ—Ä–º–µ—Ç–∏–∫–∏ -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ö—Ä–µ–ø–µ–∂" (ID: 8)
  '–ö–ª–µ–π –ü–í–ê': 8,
  '–ì–µ—Ä–º–µ—Ç–∏–∫ —Å–∏–ª–∏–∫–æ–Ω–æ–≤—ã–π': 8,

  // –ë—Ä—É—Å -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ë—Ä—É—Å" (ID: 6)
  '–ë—Ä—É—Å 40x40 –º–º': 6,
  '–ë—Ä—É—Å 50x50 –º–º': 6,
  '–ë—Ä—É—Å 60x60 –º–º': 6,
  '–ë—Ä—É—Å 80x80 –º–º': 6,
  '–ë—Ä—É—Å 100x100 –º–º': 6,

  // –ú–µ—Ö–∞–Ω–∏–∑–º—ã -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ú–µ—Ö–∞–Ω–∏–∑–º—ã" (ID: 7)
  '–ú–µ—Ö–∞–Ω–∏–∑–º "–ê–∫–∫–æ—Ä–¥–µ–æ–Ω"': 7,
  '–ú–µ—Ö–∞–Ω–∏–∑–º "–î–µ–ª—å—Ñ–∏–Ω"': 7,
  '–ú–µ—Ö–∞–Ω–∏–∑–º "–ö–ª–∏–∫-–∫–ª—è–∫"': 7,
  '–ú–µ—Ö–∞–Ω–∏–∑–º "–ï–≤—Ä–æ–∫–Ω–∏–∂–∫–∞"': 7,

  // –ö—Ä–µ–ø–µ–∂ -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ö—Ä–µ–ø–µ–∂" (ID: 8)
  '–°–∞–º–æ—Ä–µ–∑—ã 4x50 –º–º': 8,
  '–°–∞–º–æ—Ä–µ–∑—ã 5x70 –º–º': 8,
  '–£–≥–æ–ª–∫–∏ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ': 8,
  '–°–∫–æ–±—ã –º–µ–±–µ–ª—å–Ω—ã–µ 14 –º–º': 8,

  // –ù–∞–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ù–∞–ø–æ–ª–Ω–∏—Ç–µ–ª–∏" (ID: 10)
  '–°–∏–Ω—Ç–µ–ø–æ–Ω 200 –≥/–º¬≤': 10,
  '–°–∏–Ω—Ç–µ–ø–æ–Ω 300 –≥/–º¬≤': 10,
  '–•–æ–ª–ª–æ—Ñ–∞–π–±–µ—Ä': 10,
  '–ü–µ—Ä–∏–æ—Ç–µ–∫': 10,

  // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç" (ID: 9)
  '–®—É—Ä—É–ø–æ–≤–µ—Ä—Ç –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω—ã–π': 9,
  '–î—Ä–µ–ª—å —É–¥–∞—Ä–Ω–∞—è': 9,
  '–õ–æ–±–∑–∏–∫ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π': 9,
  '–†—É–±–∞–Ω–æ–∫ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π': 9,
  '–§—Ä–µ–∑–µ—Ä —Ä—É—á–Ω–æ–π': 9,
  '–°—Ç–µ–ø–ª–µ—Ä –º–µ–±–µ–ª—å–Ω—ã–π': 9,
  '–ü–∏—Å—Ç–æ–ª–µ—Ç –¥–ª—è –∫–ª–µ—è': 9,
  '–ù–∞–±–æ—Ä –æ—Ç–≤–µ—Ä—Ç–æ–∫': 9,
  '–ù–∞–±–æ—Ä –∫–ª—é—á–µ–π': 9,
  '–†—É–ª–µ—Ç–∫–∞ 5–º': 9,

  // –ì–æ—Ç–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ì–æ—Ç–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è" (ID: 11)
  '–î–∏–≤–∞–Ω "–ù–µ–∞–ø–æ–ª—å"': 11,
  '–ö—Ä–µ—Å–ª–æ "–ú–æ–¥–µ—Ä–Ω"': 11,
  '–ü—É—Ñ "–ö—Ä—É–≥–ª—ã–π"': 11,
  '–°—Ç–æ–ª –∂—É—Ä–Ω–∞–ª—å–Ω—ã–π': 11
};

const fixMaterialCategories = async () => {
  try {
    console.log('üîß –ù–∞—á–∏–Ω–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...');

    let fixedCount = 0;
    let errorCount = 0;

    for (const [materialName, correctCategoryId] of Object.entries(correctMappings)) {
      try {
        // –ù–∞—Ö–æ–¥–∏–º –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ –∏–º–µ–Ω–∏
        const materialResult = await db.query(
          'SELECT id, name, category_id FROM materials WHERE name = $1',
          [materialName]
        );

        if (materialResult.rows.length === 0) {
          console.log(`‚ö†Ô∏è  –ú–∞—Ç–µ—Ä–∏–∞–ª "${materialName}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
          continue;
        }

        const material = materialResult.rows[0];
        
        if (material.category_id === correctCategoryId) {
          console.log(`‚úÖ "${materialName}" —É–∂–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏`);
          continue;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        await db.query(
          'UPDATE materials SET category_id = $1, updated_at = NOW() WHERE id = $2',
          [correctCategoryId, material.id]
        );

        console.log(`üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: "${materialName}" -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è ID ${correctCategoryId}`);
        fixedCount++;

      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ "${materialName}":`, error.message);
        errorCount++;
      }
    }

    console.log('\nüéâ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
    console.log(`‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: ${fixedCount} –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤`);
    console.log(`‚ùå –û—à–∏–±–æ–∫: ${errorCount} –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤`);

  } catch (error) {
    console.error('‚ùå –û–±—â–∞—è –æ—à–∏–±–∫–∞:', error);
  } finally {
    process.exit(0);
  }
};

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç
fixMaterialCategories();







