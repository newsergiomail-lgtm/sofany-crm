#!/bin/bash

echo "๐ง ะัะฟัะฐะฒะปะตะฝะธะต ะฟัะพะฑะปะตะผ ั ะฟะพััะฐะผะธ..."

# ะฃะฑะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั Node.js
echo "๐ ะััะฐะฝะพะฒะบะฐ ะฒัะตั ะฟัะพัะตััะพะฒ Node.js..."
pkill -f "node" 2>/dev/null || true
pkill -f "react-scripts" 2>/dev/null || true
pkill -f "nodemon" 2>/dev/null || true

# ะะดะตะผ ะทะฐะฒะตััะตะฝะธั ะฟัะพัะตััะพะฒ
sleep 3

# ะัะธะฝัะดะธัะตะปัะฝะพ ะพัะฒะพะฑะพะถะดะฐะตะผ ะฟะพััั
echo "๐ ะัะฒะพะฑะพะถะดะตะฝะธะต ะฟะพััะพะฒ..."
lsof -ti:5000 | xargs kill -9 2>/dev/null || true
lsof -ti:3000 | xargs kill -9 2>/dev/null || true
lsof -ti:3001 | xargs kill -9 2>/dev/null || true

# ะะดะตะผ ะตัะต ะฝะตะผะฝะพะณะพ
sleep 2

echo "โ ะะพัััั ะพัะฒะพะฑะพะถะดะตะฝั"
echo "๐ ะะฐะฟััะบ ัะตัะฒะตัะฐ..."

# ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั
cd server
node index.js &
SERVER_PID=$!

# ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ
sleep 5

# ะัะพะฒะตััะตะผ ััะฐััั
if curl -s http://localhost:5000/api/health >/dev/null 2>&1; then
    echo "โ ะกะตัะฒะตั ััะฟะตัะฝะพ ะทะฐะฟััะตะฝ ะฝะฐ ะฟะพััั 5000"
    echo "๐ API ะดะพัััะฟะตะฝ ะฟะพ ะฐะดัะตัั: http://localhost:5000"
else
    echo "โ ะกะตัะฒะตั ะฝะต ะทะฐะฟัััะธะปัั"
    echo "๐ ะัะพะฒะตัััะต ะปะพะณะธ ะฒััะต ะดะปั ะดะธะฐะณะฝะพััะธะบะธ"
fi

echo "๐ ะะปั ะพััะฐะฝะพะฒะบะธ ัะตัะฒะตัะฐ ะฝะฐะถะผะธัะต Ctrl+C"
wait $SERVER_PID
